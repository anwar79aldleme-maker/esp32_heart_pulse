<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BPM Live Signal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  background:#0a0f1a;
  color:#00ffff;
  font-family:Segoe UI;
}
header{
  padding:15px;
  text-align:center;
  font-size:22px;
  box-shadow:0 0 15px cyan;
}
.card{
  margin:20px;
  background:rgba(0,0,0,.6);
  padding:20px;
  border-radius:14px;
  box-shadow:0 0 20px rgba(0,255,255,.3);
}
.value{
  font-size:42px;
  text-align:center;
  margin-bottom:10px;
}
canvas{ height:320px !important; }
</style>
</head>

<body>

<header>ðŸ«€ Live BPM Signal</header>

<div class="card">
  <div class="value" id="bpmValue">-- BPM</div>
  <canvas id="bpmChart"></canvas>
</div>

<script>
const MAX_POINTS = 120;
let labels = [];
let bpmData = [];

const ctx = document.getElementById('bpmChart').getContext('2d');

const bpmChart = new Chart(ctx,{
  type:'line',
  data:{
    labels,
    datasets:[{
      label:'BPM',
      data:bpmData,
      borderColor:'#00ffff',
      borderWidth:2,
      tension:0.3,
      pointRadius:2
    }]
  },
  options:{
    animation:false,
    responsive:true,
    scales:{
      x:{ display:false },
      y:{
        min:40,
        max:180,
        ticks:{ stepSize:10 }
      }
    }
  }
});

// ==========================
// Load BPM from API
// ==========================
async function loadBPM(){
  const res = await fetch('/api/pulse');
  const data = await res.json();
  if(!data.length) return;

  const last = data[data.length - 1];
  const bpm = last.bpm;

  document.getElementById('bpmValue').innerText = bpm + ' BPM';

  bpmData.push(bpm);
  labels.push('');

  if(bpmData.length > MAX_POINTS){
    bpmData.shift();
    labels.shift();
  }

  bpmChart.update();
}

// ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø«Ø§Ù†ÙŠØªÙŠÙ† (Ø­Ø³Ø¨ Ø¥Ø±Ø³Ø§Ù„ ESP32)
setInterval(loadBPM, 2000);
loadBPM();
</script>

</body>
</html>

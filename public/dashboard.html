<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ESP32 Heart Waveform</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  background:#0a0f1a;
  color:#00ffff;
  font-family:Segoe UI;
}
header{
  padding:15px;
  text-align:center;
  font-size:22px;
  box-shadow:0 0 15px cyan;
}
.card{
  margin:20px;
  background:rgba(0,0,0,.6);
  padding:20px;
  border-radius:14px;
  box-shadow:0 0 20px rgba(0,255,255,.3);
}
canvas{
  height:300px !important;
}
</style>
</head>

<body>

<script>
if(localStorage.getItem('auth')!=='1') location.href='/login.html';
</script>

<header>
❤️ ESP32 Heart Pulse Waveform
</header>

<div class="card">
  <canvas id="waveChart"></canvas>
</div>

<script>
const MAX_POINTS = 200;
let labels = [];
let waveData = [];

const ctx = document.getElementById('waveChart').getContext('2d');

const waveChart = new Chart(ctx,{
  type:'line',
  data:{
    labels,
    datasets:[{
      label:'Heart Pulse Signal',
      data:waveData,
      borderColor:'#00ffff',
      borderWidth:2,
      tension:0.4,
      pointRadius:0,
      fill:false
    }]
  },
  options:{
    animation:false,
    responsive:true,
    scales:{
      x:{ display:false },
      y:{
        min:0,
        max:1023   /* عدلها حسب دقة ADC */
      }
    }
  }
});

async function loadWave(){
  const res = await fetch('/api/get');
  const data = await res.json();
  if(!data.length) return;

  const last = data[data.length-1];

  waveData.push(last.pulse);
  labels.push('');

  if(waveData.length > MAX_POINTS){
    waveData.shift();
    labels.shift();
  }

  waveChart.update();
}

setInterval(loadWave,100); // سرعة الرسم
</script>

</body>
</html>

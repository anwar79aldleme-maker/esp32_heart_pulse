<!DOCTYPE html>
<html>
<head>
  <title>Heart Pulse Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <canvas id="pulseChart" width="800" height="400"></canvas>
  <script>
    const ctx = document.getElementById('pulseChart').getContext('2d');
    const pulseData = {
      labels: [],
      datasets: [{
        label: 'BPM',
        data: [],
        borderColor: 'red',
        fill: false,
        tension: 0.4
      }]
    };
    const config = {
      type: 'line',
      data: pulseData,
      options: {
        animation: false,
        responsive: false,
        scales: { x: { display: false } }
      }
    };
    const chart = new Chart(ctx, config);

    async function update() {
      try {
        const res = await fetch('/api/pulse');
        const data = await res.json();

        if(data.signal && data.signal.length > 0){
          data.signal.forEach(p => {
            pulseData.labels.push(p.time);
            pulseData.datasets[0].data.push(p.bpm);
          });
          // حافظ على آخر 100 نقطة
          if(pulseData.labels.length > 100){
            pulseData.labels = pulseData.labels.slice(-100);
            pulseData.datasets[0].data = pulseData.datasets[0].data.slice(-100);
          }
          chart.update();
        }
      } catch(err){
        console.error(err);
      }
      setTimeout(update, 100); // تحديث كل 100ms
    }

    update();
  </script>
</body>
</html>

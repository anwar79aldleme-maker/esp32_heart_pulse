<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Heart Pulse Dashboard</title>
<style>
  canvas { border: 1px solid black; }
</style>
</head>
<body>
<h1>Heart Pulse Live</h1>
<canvas id="pulseCanvas" width="800" height="200"></canvas>

<script>
const canvas = document.getElementById("pulseCanvas");
const ctx = canvas.getContext("2d");
let signal = [];

async function update() {
  try {
    const res = await fetch("/api/pulse");
    const data = await res.json();
    signal = data.signal || [];
    draw();
  } catch (e) {
    console.error("Failed to fetch:", e);
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.beginPath();
  const len = signal.length;
  for (let i = 0; i < len; i++) {
    const x = (i / 600) * canvas.width;
    const y = canvas.height - (signal[i] / 4095) * canvas.height;
    if (i === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  }
  ctx.strokeStyle = "red";
  ctx.lineWidth = 2;
  ctx.stroke();
}

setInterval(update, 100);  // تحديث كل 100ms
</script>
</body>
</html>
